{
  "scopeName": "source.opsi-script",
  "name": "opsi-script",
  "uuid": "08cd1012-1f35-44bf-a64a-ebf3f82c8978",
  "fileTypes": [
    ".opsiscript",
    ".ins"
  ],
  "repository": {
    "core": {
      "patterns": [
        {
          "include": "#comments"
        },
        {
          "include": "#primary-sections"
        },
        {
          "include": "#secondary-sections"
        }
      ]
    },
    "expressions": {
      "patterns": [
        {
          "include": "#brackets"
        },
        {
          "include": "#primary-section-keywords"
        },
        {
          "include": "#primary-section-operators"
        },
        {
          "include": "#primary-section-number"
        },
        {
          "include": "#primary-section-string"
        },
        {
          "include": "#literal-constant"
        },
        {
          "include": "#literal-variable"
        }
      ]
    },
    "comments": {
      "patterns": [
        {
          "name": "comment.line.semicolon.opsi-script",
          "match": "^(;).*$\\n?",
          "captures": {
            "1": {
              "name": "punctuation.definition.comment.opsi-script"
            }
          }
        }
      ]
    },
    "brackets": {
      "patterns": [
        {
          "include": "#round-brackets"
        }
      ]
    },
    "round-brackets": {
      "patterns": [
        {
          "name": "meta.group.braces.round",
          "begin": "\\(",
          "beginCaptures": {
            "0": {
              "name": "meta.brace.round.opsi-script"
            }
          },
          "end": "\\)",
          "endCaptures": {
            "0": {
              "name": "meta.brace.round.opsi-script"
            }
          },
          "patterns": [
            {
              "include": "#expressions"
            }
          ]
        }
      ]
    },
    "literal-constant": {
      "patterns": [
        {
          "name": "constant.language.builtin.percent.opsi-script",
          "match": "(?i)(%)(HostID|ScriptPath)(%)",
          "captures": {
            "1": {
              "name": "punctuation.percent.opsi-script"
            },
            "2": {
              "name": "punctuation.percent.opsi-script"
            }
          }
        }
      ]
    },
    "literal-variable": {
      "patterns": [
        {
          "name": "variable.other.dollar.opsi-script",
          "match": "(\\$)[$\\w]+(\\$)",
          "captures": {
            "1": {
              "name": "punctuation.dollar.opsi-script"
            },
            "2": {
              "name": "punctuation.dollar.opsi-script"
            }
          }
        }
      ]
    },
    "primary-section": {
      "patterns": [
        {
          "include": "#comments"
        },
        {
          "include": "#expressions"
        },
        {
          "include": "#secondary-section-calls"
        },
        {
          "include": "#primary-section-functions"
        }
      ]
    },
    "primary-sections": {
      "patterns": [
        {
          "name": "meta.primary-section.actions.opsi-script",
          "begin": "(?i)^(\\[)(Actions|Aktionen)(\\])",
          "beginCaptures": {
            "2": {
              "name": "entity.name.type.primary-section.opsi-script"
            }
          },
          "while": "^(?!\\[.*\\]$)",
          "patterns": [
            {
              "include": "#primary-section"
            }
          ]
        },
        {
          "name": "meta.primary-section.sub.opsi-script",
          "begin": "(?i)^(\\[)(Sub\\S+)(\\])",
          "beginCaptures": {
            "2": {
              "name": "entity.name.type.primary-section.opsi-script"
            }
          },
          "while": "^(?!\\[.*\\]$)",
          "patterns": [
            {
              "include": "#primary-section"
            }
          ]
        }
      ]
    },
    "primary-section-functions": {
      "patterns": [
        {
          "name": "support.variable.builtin.opsi-script",
          "match": "(?<!\\.)(?i)\\b(SetLogLevel)\\b"
        },
        {
          "name": "support.function.builtin.logging.opsi-script",
          "match": "(?<!\\.)(?i)\\b(comment|LogError|isFatalError)\\b"
        },
        {
          "name": "support.function.builtin.list.opsi-script",
          "match": "(?<!\\.)(?i)\\b(takeString|getValue)\\b"
        },
        {
          "name": "support.function.builtin.string.opsi-script",
          "match": "(?<!\\.)(?i)\\b(asConfidential|strPart|strLength|isRegexMatch)\\b"
        },
        {
          "name": "support.function.builtin.numeric.opsi-script",
          "match": "(?<!\\.)(?i)\\b(calculate)\\b"
        },
        {
          "name": "support.function.builtin.service.opsi-script",
          "match": "(?<!\\.)(?i)\\b(GetProductProperty)\\b"
        },
        {
          "name": "support.function.builtin.subprocess.opsi-script",
          "match": "(?<!\\.)(?i)\\b(ShellCall|GetLastExitcode)\\b"
        }
      ]
    },
    "primary-section-keyword-storage": {
      "patterns": [
        {
          "name": "storage.type.opsi-script",
          "match": "(?i)(?<!\\.)\\b(DefVar|DefStringList|Set)\\b"
        }
      ]
    },
    "primary-section-keywords": {
      "patterns": [
        {
          "include": "#primary-section-keyword-storage"
        },
        {
          "name": "keyword.control.opsi-script",
          "match": "(?i)\\b(if|else|endif)\\b"
        }
      ]
    },
    "primary-section-operators": {
      "patterns": [
        {
          "name": "keyword.operator.wordlike.opsi-script",
          "match": "\\b(and|or|not)\\b"
        }
      ]
    },
    "primary-section-string": {
      "patterns": [
        {
          "name": "string.quoted.single.primary-section-string.opsi-script",
          "begin": "'",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.string.begin.opsi-script"
            }
          },
          "end": "(')|(\\n)",
          "endCaptures": {
            "1": {
              "name": "punctuation.definition.string.end.opsi-script"
            },
            "2": {
              "name": "invalid.illegal.newline.opsi-script"
            }
          },
          "patterns": [
            {
              "include": "#literal-constant"
            }
          ]
        },
        {
          "name": "string.quoted.double.primary-section-string.opsi-script",
          "begin": "\"",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.string.begin.opsi-script"
            }
          },
          "end": "(\")|(\\n)",
          "endCaptures": {
            "1": {
              "name": "punctuation.definition.string.end.opsi-script"
            },
            "2": {
              "name": "invalid.illegal.newline.opsi-script"
            }
          },
          "patterns": [
            {
              "include": "#literal-constant"
            }
          ]
        }
      ]
    },
    "primary-section-number": {
      "patterns": [
        {
          "name": "constant.numeric.js",
          "match": "(?xi)\\b[0-9]+"
        }
      ]
    },
    "secondary-section-calls": {
      "patterns": [
        {
          "name": "meta.secondary-section-call.without-arguments.opsi-script",
          "match": "(?i)\\b(ShellBatch\\S+|ShellInAnIcon\\S+|DosBatch\\S+|DosInAnIcon\\S+|ExecWith\\S+|PatchTextFile\\S+)\\b",
          "captures": {
            "1": {
              "name": "entity.name.type.secondary-section-call.opsi-script"
            }
          }
        }
      ]
    },
    "secondary-sections": {
      "patterns": [
        {
          "name": "meta.secondary-section.shell-batch.opsi-script",
          "begin": "(?i)^(\\[)(ShellBatch[^\\]]+|ShellInAnIcon[^\\]]+)(\\])",
          "beginCaptures": {
            "2": {
              "name": "entity.name.type.secondary-section-shell-batch.opsi-script"
            }
          },
          "while": "^(?!\\[.*\\]$)",
          "contentName": "meta.embedded.block.shellscript",
          "patterns": [
            {
              "include": "#secondary-section"
            },
            {
              "include": "source.shell"
            }
          ]
        },
        {
          "name": "meta.secondary-section.dos-batch.opsi-script",
          "begin": "(?i)^(\\[)(DosBatch[^\\]]+|DosInAnIcon[^\\]]+)(\\])",
          "beginCaptures": {
            "2": {
              "name": "entity.name.type.secondary-section-dos-batch.opsi-script"
            }
          },
          "while": "^(?!\\[.*\\]$)",
          "contentName": "meta.embedded.block.dosbatch",
          "patterns": [
            {
              "include": "#secondary-section"
            },
            {
              "include": "source.batchfile"
            }
          ]
        },
        {
          "name": "meta.secondary-section.exec-with-powershell.opsi-script",
          "begin": "(?i)^(\\[)(ExecWith[^\\]]*powershell[^\\]]*)(\\])",
          "beginCaptures": {
            "2": {
              "name": "entity.name.type.secondary-section-exec-with-powershell.opsi-script"
            }
          },
          "while": "^(?!\\[.*\\]$)",
          "contentName": "meta.embedded.block.powershell",
          "patterns": [
            {
              "include": "#secondary-section"
            },
            {
              "include": "source.powershell"
            }
          ]
        },
        {
          "name": "meta.secondary-section.exec-with-general.opsi-script",
          "begin": "(?i)^(\\[)(ExecWith[^\\]]+)(\\])",
          "beginCaptures": {
            "2": {
              "name": "entity.name.type.secondary-section-exec-with-general.opsi-script"
            }
          },
          "while": "^(?!\\[.*\\]$)",
          "contentName": "meta.embedded.block.general",
          "patterns": [
            {
              "include": "#secondary-section"
            }
          ]
        },
        {
          "name": "meta.secondary-section.patch-text-file.opsi-script",
          "begin": "(?i)^(\\[)(PatchTextFile[^\\]]+)(\\])",
          "beginCaptures": {
            "2": {
              "name": "entity.name.type.secondary-section-patch-text-file.opsi-script"
            }
          },
          "while": "^(?!\\[.*\\]$)",
          "patterns": [
            {
              "include": "#secondary-section"
            },
            {
              "include": "#secondary-section-patch-text-file"
            }
          ]
        }
      ]
    },
    "secondary-section": {
      "patterns": [
        {
          "include": "#comments"
        },
        {
          "include": "#secondary-section-string"
        },
        {
          "include": "#literal-constant"
        },
        {
          "include": "#literal-variable"
        }
      ]
    },
    "secondary-section-patch-text-file": {
      "patterns": [
        {
          "name": "support.function.builtin.secondary-section.patchtextfile.opsi-script",
          "match": "(?<!\\.)(?i)\\b(FindLine_Containing|DeleteTheLine|InsertLine)\\b"
        }
      ]
    },
    "secondary-section-string": {
      "patterns": [
        {
          "name": "string.quoted.single.secondary-section-string.opsi-script",
          "begin": "'",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.string.begin.opsi-script"
            }
          },
          "end": "(')|(\\n)",
          "endCaptures": {
            "1": {
              "name": "punctuation.definition.string.end.opsi-script"
            },
            "2": {
              "name": "invalid.illegal.newline.opsi-script"
            }
          },
          "patterns": [
            {
              "include": "#literal-constant"
            },
            {
              "include": "#literal-variable"
            }
          ]
        },
        {
          "name": "string.quoted.double.secondary-section-string.opsi-script",
          "begin": "\"",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.string.begin.opsi-script"
            }
          },
          "end": "(\")|(\\n)",
          "endCaptures": {
            "1": {
              "name": "punctuation.definition.string.end.opsi-script"
            },
            "2": {
              "name": "invalid.illegal.newline.opsi-script"
            }
          },
          "patterns": [
            {
              "include": "#literal-constant"
            },
            {
              "include": "#literal-variable"
            }
          ]
        }
      ]
    }
  },
  "patterns": [
    {
      "include": "#core"
    }
  ]
}
